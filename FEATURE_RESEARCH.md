# Clawdbot DingTalk åŠŸèƒ½è°ƒç ”ä¸å¼€å‘è·¯çº¿å›¾

> åŸºäº Clawdbot Plugins SDK å’Œ DingTalk API çš„æ·±åº¦åˆ†æ

## ä¸€ã€Clawdbot Plugins SDK åŠŸèƒ½æ€»ç»“

### 1.1 æ ¸å¿ƒæ¶æ„

| å±‚çº§ | ç»„ä»¶ | è¯´æ˜ |
|------|------|------|
| æ’ä»¶å®šä¹‰ | `MoltbotPluginDefinition` | æ’ä»¶å…ƒæ•°æ®ã€é…ç½®æ¶æ„ã€æ³¨å†Œå›è°ƒ |
| Plugin API | `MoltbotPluginApi` | å·¥å…·æ³¨å†Œã€é’©å­æ³¨å†Œã€HTTPè·¯ç”±ç­‰ |
| Channel Plugin | `ChannelPlugin` | é€šé“é€‚é…å™¨æ¥å£é›†åˆ |
| Adapters | 20+ é€‚é…å™¨ | é…ç½®ã€æ¶ˆæ¯ã€å®‰å…¨ã€ç¾¤ç»„ã€ç½‘å…³ç­‰ |

### 1.2 æ’ä»¶æ³¨å†Œèƒ½åŠ›

```typescript
api.registerChannel()      // æ³¨å†Œé€šé“æ’ä»¶
api.registerTool()         // æ³¨å†Œå·¥å…·ï¼ˆä¾› Agent è°ƒç”¨ï¼‰
api.registerHook()         // æ³¨å†Œç”Ÿå‘½å‘¨æœŸé’©å­
api.registerHttpRoute()    // æ³¨å†Œ HTTP è·¯ç”±
api.registerHttpHandler()  // æ³¨å†Œ HTTP å¤„ç†å™¨
api.registerService()      // æ³¨å†Œåå°æœåŠ¡
api.registerCommand()      // æ³¨å†Œå‘½ä»¤å¤„ç†å™¨
api.registerProvider()     // æ³¨å†Œ AI æ¨¡å‹æä¾›è€…
api.registerGatewayMethod()// æ³¨å†Œç½‘å…³æ–¹æ³•
api.registerCli()          // æ³¨å†Œ CLI å‘½ä»¤
```

### 1.3 ç”Ÿå‘½å‘¨æœŸé’©å­ï¼ˆ12ç§ï¼‰

| é’©å­åç§° | è§¦å‘æ—¶æœº | å¯ç”¨æ“ä½œ |
|---------|---------|---------|
| `before_agent_start` | Agent è¿è¡Œå‰ | ä¿®æ”¹ systemPrompt |
| `agent_end` | Agent å®Œæˆå | è®°å½•æ—¥å¿—ã€ç»Ÿè®¡ |
| `message_received` | æ”¶åˆ°æ¶ˆæ¯æ—¶ | è¿‡æ»¤ã€é¢„å¤„ç† |
| `message_sending` | å‘é€æ¶ˆæ¯å‰ | ä¿®æ”¹å†…å®¹ã€ä¸­æ­¢ |
| `message_sent` | å‘é€æ¶ˆæ¯å | è®°å½•æ—¥å¿— |
| `before_tool_call` | å·¥å…·è°ƒç”¨å‰ | ä¿®æ”¹å‚æ•°ã€é˜»æ­¢ |
| `after_tool_call` | å·¥å…·è°ƒç”¨å | è®°å½•ç»“æœ |
| `session_start` | ä¼šè¯å¼€å§‹ | åˆå§‹åŒ–ä¸Šä¸‹æ–‡ |
| `session_end` | ä¼šè¯ç»“æŸ | æ¸…ç†èµ„æº |
| `gateway_start` | ç½‘å…³å¯åŠ¨ | åˆå§‹åŒ–è¿æ¥ |
| `gateway_stop` | ç½‘å…³åœæ­¢ | æ¸…ç†è¿æ¥ |
| `before_compaction` | ä¼šè¯å‹ç¼©å‰ | ä¿ç•™é‡è¦å†…å®¹ |

### 1.4 é€šé“èƒ½åŠ›å£°æ˜

```typescript
type ChannelCapabilities = {
  chatTypes: ["direct", "group", "channel", "thread"];
  polls?: boolean;        // æŠ•ç¥¨
  reactions?: boolean;    // è¡¨æƒ…ååº”
  edit?: boolean;         // ç¼–è¾‘æ¶ˆæ¯
  unsend?: boolean;       // æ’¤å›æ¶ˆæ¯
  reply?: boolean;        // å¼•ç”¨å›å¤
  effects?: boolean;      // æ¶ˆæ¯æ•ˆæœ
  groupManagement?: boolean; // ç¾¤ç®¡ç†
  threads?: boolean;      // çº¿ç¨‹/è¯é¢˜
  media?: boolean;        // åª’ä½“æ–‡ä»¶
  nativeCommands?: boolean; // åŸç”Ÿå‘½ä»¤
  blockStreaming?: boolean; // å—å¼æµä¼ è¾“
}
```

### 1.5 æ¶ˆæ¯åŠ¨ä½œï¼ˆ51ç§ï¼‰

- **åŸºç¡€**: send, broadcast, poll, reply, sendWithEffect
- **äº¤äº’**: react, reactions, read, edit, delete, unsend
- **ç¾¤ç®¡ç†**: renameGroup, setGroupIcon, addParticipant, removeParticipant, leaveGroup
- **å†…å®¹**: sendAttachment, pin, unpin, list-pins, sticker
- **æŸ¥è¯¢**: search, emoji-list, member-info, role-info, channel-info
- **é«˜çº§**: timeout, kick, ban, permissions, thread-create

### 1.6 é€‚é…å™¨æ¥å£

| é€‚é…å™¨ | åŠŸèƒ½ |
|--------|------|
| `ChannelConfigAdapter` | è´¦æˆ·é…ç½®ç®¡ç† |
| `ChannelOutboundAdapter` | æ¶ˆæ¯å‘é€ |
| `ChannelGatewayAdapter` | å¯åŠ¨/åœæ­¢/ç™»å½• |
| `ChannelSecurityAdapter` | DM/ç¾¤ç»„æƒé™ç­–ç•¥ |
| `ChannelGroupAdapter` | ç¾¤ç»„çº§åˆ«ç­–ç•¥ |
| `ChannelMentionAdapter` | @æåŠå¤„ç† |
| `ChannelThreadingAdapter` | çº¿ç¨‹æ”¯æŒ |
| `ChannelMessagingAdapter` | ç›®æ ‡è§£æ |
| `ChannelDirectoryAdapter` | ç”¨æˆ·/ç¾¤ç»„ç›®å½• |
| `ChannelMessageActionAdapter` | æ¶ˆæ¯æ“ä½œå¤„ç† |
| `ChannelStatusAdapter` | çŠ¶æ€ç›‘æ§ |
| `ChannelHeartbeatAdapter` | å¥åº·æ£€æŸ¥ |
| `ChannelStreamingAdapter` | æµå¼ä¼ è¾“æ§åˆ¶ |
| `ChannelCommandAdapter` | å‘½ä»¤å¤„ç† |
| `ChannelAgentPromptAdapter` | Agent æç¤ºå¢å¼º |

---

## äºŒã€DingTalk API èƒ½åŠ›æ€»ç»“

### 2.1 å½“å‰å·²å®ç°åŠŸèƒ½

| åŠŸèƒ½ | çŠ¶æ€ | å®ç°æ–¹å¼ |
|------|------|---------|
| Stream æ¶ˆæ¯æ¥æ”¶ | âœ… | `dingtalk-stream` SDK |
| æ–‡æœ¬æ¶ˆæ¯å‘é€ | âœ… | sessionWebhook / ä¸»åŠ¨ API |
| Markdown æ¶ˆæ¯ | âœ… | sessionWebhook / ä¸»åŠ¨ API |
| ç¾¤èŠæ”¯æŒ | âœ… | chatType åŒºåˆ† |
| ç”¨æˆ·è¿‡æ»¤ | âœ… | allowFrom é…ç½® |
| å¤šè´¦æˆ· | âœ… | accounts é…ç½® |
| æ¶ˆæ¯åˆ†å— | âœ… | æ™ºèƒ½åˆ†å—ç®—æ³• |
| æ¶ˆæ¯åˆå¹¶ | âœ… | coalesce é…ç½® |
| æ¨¡å‹åˆ‡æ¢å‘½ä»¤ | âœ… | /model, /models |
| Thinking ä»£ç† | âœ… | DashScope ä»£ç†æœåŠ¡ |

### 2.2 DingTalk API èƒ½åŠ›çŸ©é˜µ

| API ç±»åˆ« | DingTalk æ”¯æŒ | æœ¬æ’ä»¶å®ç° |
|---------|-------------|-----------|
| **æ¶ˆæ¯ç±»å‹** | | |
| æ–‡æœ¬æ¶ˆæ¯ | âœ… | âœ… |
| Markdown æ¶ˆæ¯ | âœ… | âœ… |
| ActionCard äº’åŠ¨å¡ç‰‡ | âœ… | âŒ |
| FeedCard ä¿¡æ¯æµå¡ç‰‡ | âœ… | âŒ |
| é“¾æ¥å¡ç‰‡ | âœ… | âŒ |
| å›¾ç‰‡æ¶ˆæ¯ | âœ… | âŒ |
| æ–‡ä»¶æ¶ˆæ¯ | âœ… | âŒ |
| è¯­éŸ³æ¶ˆæ¯ | âœ… | âŒ |
| **ç¾¤ç®¡ç†** | | |
| è·å–ç¾¤æˆå‘˜ | âœ… | âŒ |
| æ·»åŠ ç¾¤æˆå‘˜ | âœ… | âŒ |
| ç§»é™¤ç¾¤æˆå‘˜ | âœ… | âŒ |
| ä¿®æ”¹ç¾¤ä¿¡æ¯ | âœ… | âŒ |
| åˆ›å»ºç¾¤èŠ | âœ… | âŒ |
| **ç”¨æˆ·ç®¡ç†** | | |
| è·å–ç”¨æˆ·è¯¦æƒ… | âœ… | âŒ |
| é€šè®¯å½•æŸ¥è¯¢ | âœ… | âŒ |
| éƒ¨é—¨ä¿¡æ¯ | âœ… | âŒ |
| **é«˜çº§åŠŸèƒ½** | | |
| @æåŠæ£€æµ‹ | âœ… | âŒ |
| æ¶ˆæ¯å·²è¯»å›æ‰§ | âœ… | âŒ |
| æ¶ˆæ¯æ’¤å› | âœ… | âŒ |
| AI Graph API | âœ… | âŒ (é¢„ç•™) |

---

## ä¸‰ã€åŠŸèƒ½å¼€å‘ä¼˜å…ˆçº§æ’åº

> æŒ‰ç”¨æˆ·ä½“éªŒæå‡ç¨‹åº¦ä»é«˜åˆ°ä½æ’åˆ—

### ğŸ”´ P0 - å…³é”®ä½“éªŒæå‡ï¼ˆå¼ºçƒˆæ¨èï¼‰

#### 1. äº’åŠ¨å¡ç‰‡ (ActionCard) æ”¯æŒ
**ä»·å€¼**: â­â­â­â­â­ | **å¤æ‚åº¦**: ä¸­

- æ”¯æŒå¯ç‚¹å‡»æŒ‰é’®çš„å¡ç‰‡æ¶ˆæ¯
- å®ç°å¤šé€‰é¡¹å¡ç‰‡ï¼ˆå¦‚ç¡®è®¤/å–æ¶ˆã€å¤šä¸ªæ“ä½œé€‰é¡¹ï¼‰
- æ”¯æŒå¡ç‰‡å›è°ƒå¤„ç†
- **ç”¨æˆ·ä½“éªŒæå‡**:
  - ç”¨æˆ·å¯é€šè¿‡ç‚¹å‡»æŒ‰é’®ä¸ AI äº¤äº’ï¼Œæ— éœ€è¾“å…¥æ–‡å­—
  - é€‚åˆå‘½ä»¤é€‰æ‹©ã€ç¡®è®¤æ“ä½œã€å¿«é€Ÿå›å¤ç­‰åœºæ™¯
  - è®©äº¤äº’æ›´ç›´è§‚ã€æ›´é«˜æ•ˆ

#### 2. å›¾ç‰‡å‘é€æ”¯æŒ
**ä»·å€¼**: â­â­â­â­â­ | **å¤æ‚åº¦**: ä¸­

- å®ç° DingTalk å›¾ç‰‡ä¸Šä¼  API
- æ”¯æŒä» URL å‘é€å›¾ç‰‡
- æ”¯æŒæœ¬åœ°æ–‡ä»¶ä¸Šä¼ 
- **ç”¨æˆ·ä½“éªŒæå‡**:
  - AI ç”Ÿæˆçš„å›¾è¡¨ã€æµç¨‹å›¾å¯ç›´æ¥å±•ç¤º
  - ä»£ç æˆªå›¾ã€UI è®¾è®¡å›¾å¯è§†åŒ–
  - å¤§å¹…æå‡ä¿¡æ¯ä¼ é€’æ•ˆç‡

#### 3. æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½æ”¯æŒ
**ä»·å€¼**: â­â­â­â­â­ | **å¤æ‚åº¦**: ä¸­é«˜

- å®ç° DingTalk æ–‡ä»¶ API
- æ”¯æŒæ¥æ”¶ç”¨æˆ·å‘é€çš„æ–‡ä»¶
- æ”¯æŒå‘é€æ–‡ä»¶ç»™ç”¨æˆ·
- **ç”¨æˆ·ä½“éªŒæå‡**:
  - ç”¨æˆ·å¯å‘é€æ–‡æ¡£è®© AI åˆ†æ
  - AI å¯å‘é€ä»£ç æ–‡ä»¶ã€æŠ¥å‘Šç­‰
  - æ”¯æŒæ›´å¤æ‚çš„å·¥ä½œæµ

#### 4. @æåŠæ™ºèƒ½æ£€æµ‹
**ä»·å€¼**: â­â­â­â­ | **å¤æ‚åº¦**: ä½

- è‡ªåŠ¨æ£€æµ‹æ¶ˆæ¯ä¸­æ˜¯å¦ @æœºå™¨äºº
- å®ç° `resolveRequireMention` é€‚é…å™¨
- æ”¯æŒé…ç½®æ˜¯å¦å¿…é¡» @æ‰å“åº”
- **ç”¨æˆ·ä½“éªŒæå‡**:
  - ç¾¤èŠä¸­æ›´æ™ºèƒ½çš„è§¦å‘æœºåˆ¶
  - å‡å°‘è¯¯è§¦å‘
  - ç¬¦åˆç”¨æˆ·ä¹ æƒ¯

### ğŸŸ  P1 - é‡è¦åŠŸèƒ½å¢å¼º

#### 5. å¼•ç”¨å›å¤æ”¯æŒ
**ä»·å€¼**: â­â­â­â­ | **å¤æ‚åº¦**: ä¸­

- å®ç°æ¶ˆæ¯å¼•ç”¨åŠŸèƒ½
- å›å¤æ—¶å¸¦ä¸ŠåŸå§‹æ¶ˆæ¯ä¸Šä¸‹æ–‡
- æ”¯æŒ `replyToId` å‚æ•°
- **ç”¨æˆ·ä½“éªŒæå‡**:
  - å¤šè½®å¯¹è¯ä¸­ä¸Šä¸‹æ–‡æ›´æ¸…æ™°
  - ç¾¤èŠä¸­æŒ‡å‘æ€§å›å¤
  - ä¿¡æ¯è¿½æº¯æ›´æ–¹ä¾¿

#### 6. æ¶ˆæ¯å·²è¯»çŠ¶æ€åŒæ­¥
**ä»·å€¼**: â­â­â­â­ | **å¤æ‚åº¦**: ä¸­

- å®ç°å·²è¯»å›æ‰§ API
- æ ‡è®°æ¶ˆæ¯ä¸ºå·²è¯»
- ä¼šè¯çŠ¶æ€å¯è§†åŒ–
- **ç”¨æˆ·ä½“éªŒæå‡**:
  - ç”¨æˆ·çŸ¥é“ AI æ˜¯å¦æ”¶åˆ°æ¶ˆæ¯
  - æå‡äº¤äº’åé¦ˆæ„Ÿ

#### 7. ç”¨æˆ·ä¿¡æ¯å¢å¼º
**ä»·å€¼**: â­â­â­â­ | **å¤æ‚åº¦**: ä½

- è·å–ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ï¼ˆå§“åã€å¤´åƒã€éƒ¨é—¨ï¼‰
- é›†æˆé€šè®¯å½• API
- ç”¨æˆ·ä¸Šä¸‹æ–‡æ³¨å…¥
- **ç”¨æˆ·ä½“éªŒæå‡**:
  - AI å¯ä¸ªæ€§åŒ–ç§°å‘¼ç”¨æˆ·
  - æ ¹æ®éƒ¨é—¨æä¾›å®šåˆ¶æœåŠ¡
  - æ›´äººæ€§åŒ–çš„äº¤äº’

#### 8. ç¾¤æˆå‘˜ç›®å½•æœåŠ¡
**ä»·å€¼**: â­â­â­â­ | **å¤æ‚åº¦**: ä¸­

- å®ç° `ChannelDirectoryAdapter`
- è·å–ç¾¤æˆå‘˜åˆ—è¡¨
- æ”¯æŒ @æŒ‡å®šæˆå‘˜
- **ç”¨æˆ·ä½“éªŒæå‡**:
  - AI å¯ @é€šçŸ¥ç›¸å…³äººå‘˜
  - ç¾¤ç®¡ç†åŠŸèƒ½åŸºç¡€
  - åä½œåœºæ™¯æ”¯æŒ

### ğŸŸ¡ P2 - è¿›é˜¶åŠŸèƒ½

#### 9. å·¥å…·æ‰§è¡ŒçŠ¶æ€å¡ç‰‡
**ä»·å€¼**: â­â­â­â­ | **å¤æ‚åº¦**: ä¸­

- ä½¿ç”¨ ActionCard å±•ç¤ºå·¥å…·æ‰§è¡ŒçŠ¶æ€
- å®æ—¶æ›´æ–°æ‰§è¡Œè¿›åº¦
- æ”¯æŒä¸­æ–­/é‡è¯•æŒ‰é’®
- **ç”¨æˆ·ä½“éªŒæå‡**:
  - é•¿æ—¶é—´ä»»åŠ¡è¿›åº¦å¯è§†
  - ç”¨æˆ·å¯æ§åˆ¶ä»»åŠ¡æ‰§è¡Œ
  - å¢å¼ºä¿¡ä»»æ„Ÿ

#### 10. è¡¨æƒ…ååº”æ”¯æŒ
**ä»·å€¼**: â­â­â­ | **å¤æ‚åº¦**: ä¸­

- æ£€æµ‹ç”¨æˆ·è¡¨æƒ…ååº”
- AI å¯æ·»åŠ è¡¨æƒ…ååº”
- åé¦ˆæ”¶é›†æœºåˆ¶
- **ç”¨æˆ·ä½“éªŒæå‡**:
  - å¿«é€Ÿè¡¨è¾¾æ»¡æ„/ä¸æ»¡æ„
  - è½»é‡çº§äº¤äº’æ–¹å¼
  - ç¤¾äº¤åŒ–ä½“éªŒ

#### 11. æ¶ˆæ¯æ’¤å›/ç¼–è¾‘
**ä»·å€¼**: â­â­â­ | **å¤æ‚åº¦**: ä¸­

- æ”¯æŒ AI æ’¤å›é”™è¯¯æ¶ˆæ¯
- æ”¯æŒç¼–è¾‘å·²å‘é€æ¶ˆæ¯
- ç”¨æˆ·æ’¤å›æ¶ˆæ¯å¤„ç†
- **ç”¨æˆ·ä½“éªŒæå‡**:
  - çº é”™èƒ½åŠ›
  - æ›´çµæ´»çš„å†…å®¹ä¿®æ­£
  - é¿å…ä¿¡æ¯æ±¡æŸ“

#### 12. æ¨¡æ¿å¡ç‰‡ç³»ç»Ÿ
**ä»·å€¼**: â­â­â­â­ | **å¤æ‚åº¦**: é«˜

- é¢„å®šä¹‰å¸¸ç”¨å¡ç‰‡æ¨¡æ¿
- ä»£ç å—å¡ç‰‡ã€è¡¨æ ¼å¡ç‰‡
- ä¿¡æ¯å¡ç‰‡ã€çŠ¶æ€å¡ç‰‡
- **ç”¨æˆ·ä½“éªŒæå‡**:
  - æ ‡å‡†åŒ–ä¿¡æ¯å±•ç¤º
  - æ›´ç¾è§‚çš„è¾“å‡º
  - æå‡ä¸“ä¸šæ„Ÿ

### ğŸŸ¢ P3 - å¢å€¼åŠŸèƒ½

#### 13. æŠ•ç¥¨åŠŸèƒ½
**ä»·å€¼**: â­â­â­ | **å¤æ‚åº¦**: ä¸­

- å®ç°æŠ•ç¥¨å¡ç‰‡
- ç»“æœç»Ÿè®¡å’Œå±•ç¤º
- å¤šé€‰/å•é€‰æ”¯æŒ
- **ç”¨æˆ·ä½“éªŒæå‡**:
  - å›¢é˜Ÿå†³ç­–åœºæ™¯
  - æ”¶é›†ç¾¤ä½“æ„è§
  - äº’åŠ¨æ€§å¢å¼º

#### 14. ç¾¤ç®¡ç†å·¥å…·
**ä»·å€¼**: â­â­â­ | **å¤æ‚åº¦**: é«˜

- åˆ›å»ºç¾¤èŠ
- æ·»åŠ /ç§»é™¤æˆå‘˜
- ä¿®æ”¹ç¾¤ä¿¡æ¯
- **ç”¨æˆ·ä½“éªŒæå‡**:
  - AI è‡ªåŠ¨å»ºç¾¤åŠŸèƒ½
  - é¡¹ç›®ç¾¤ç®¡ç†
  - è‡ªåŠ¨åŒ–è¿ç»´

#### 15. æ—¥ç¨‹é›†æˆ
**ä»·å€¼**: â­â­â­ | **å¤æ‚åº¦**: é«˜

- åˆ›å»º/æŸ¥è¯¢æ—¥ç¨‹
- ä¼šè®®æé†’
- ä¸ AI åŠ©æ‰‹é›†æˆ
- **ç”¨æˆ·ä½“éªŒæå‡**:
  - æ—¶é—´ç®¡ç†åŠ©æ‰‹
  - ä¼šè®®å®‰æ’è‡ªåŠ¨åŒ–
  - æé†’æœåŠ¡

#### 16. å®¡æ‰¹æµç¨‹é›†æˆ
**ä»·å€¼**: â­â­â­ | **å¤æ‚åº¦**: é«˜

- å¯¹æ¥ DingTalk å®¡æ‰¹
- å®¡æ‰¹çŠ¶æ€æŸ¥è¯¢
- AI è¾…åŠ©å®¡æ‰¹
- **ç”¨æˆ·ä½“éªŒæå‡**:
  - è‡ªåŠ¨åŒ–å®¡æ‰¹
  - å®¡æ‰¹çŠ¶æ€è¿½è¸ª
  - ä¼ä¸šæµç¨‹é›†æˆ

#### 17. è¯­éŸ³æ¶ˆæ¯æ”¯æŒ
**ä»·å€¼**: â­â­ | **å¤æ‚åº¦**: é«˜

- æ¥æ”¶è¯­éŸ³æ¶ˆæ¯
- è¯­éŸ³è½¬æ–‡å­—
- å‘é€è¯­éŸ³æ¶ˆæ¯
- **ç”¨æˆ·ä½“éªŒæå‡**:
  - è¯­éŸ³äº¤äº’
  - æ— éšœç¢è®¿é—®
  - ç§»åŠ¨ç«¯å‹å¥½

#### 18. ä¼šè¯å†å²å¯¼å‡º
**ä»·å€¼**: â­â­â­ | **å¤æ‚åº¦**: ä¸­

- å¯¼å‡ºå¯¹è¯è®°å½•
- æ ¼å¼åŒ–è¾“å‡º
- æ–‡ä»¶ä¸‹è½½
- **ç”¨æˆ·ä½“éªŒæå‡**:
  - çŸ¥è¯†æ²‰æ·€
  - å®¡è®¡è¿½æº¯
  - åˆ†äº«èƒ½åŠ›

### ğŸ”µ P4 - ç”Ÿæ€å¢å¼º

#### 19. AI Graph API é›†æˆ
**ä»·å€¼**: â­â­â­ | **å¤æ‚åº¦**: é«˜

- å®Œå–„ AI Graph API å›è°ƒ
- ä¸ DingTalk AI èƒ½åŠ›ç»“åˆ
- æ’ä»¶å¸‚åœºæ”¯æŒ
- **ç”¨æˆ·ä½“éªŒæå‡**:
  - æ›´æ·±åº¦çš„å¹³å°é›†æˆ
  - å®˜æ–¹ AI èƒ½åŠ›å¢å¼º
  - ç”Ÿæ€æ‰©å±•

#### 20. å¤šè¯­è¨€æ¶ˆæ¯æ”¯æŒ
**ä»·å€¼**: â­â­ | **å¤æ‚åº¦**: ä¸­

- è‡ªåŠ¨è¯­è¨€æ£€æµ‹
- å¤šè¯­è¨€å›å¤
- i18n é…ç½®
- **ç”¨æˆ·ä½“éªŒæå‡**:
  - å›½é™…åŒ–æ”¯æŒ
  - è·¨å›½å›¢é˜Ÿåä½œ

#### 21. æ¶ˆæ¯æ¨¡æ¿åº“
**ä»·å€¼**: â­â­â­ | **å¤æ‚åº¦**: ä¸­

- é¢„å®šä¹‰æ¶ˆæ¯æ¨¡æ¿
- å˜é‡æ›¿æ¢ç³»ç»Ÿ
- æ¨¡æ¿ç®¡ç† API
- **ç”¨æˆ·ä½“éªŒæå‡**:
  - æ ‡å‡†åŒ–é€šçŸ¥
  - å¿«é€Ÿå›å¤
  - å“ç‰Œä¸€è‡´æ€§

---

## å››ã€åŠŸèƒ½çŸ©é˜µå¯¹æ¯”

### Clawdbot å…¶ä»–é€šé“ vs DingTalk æ’ä»¶

| åŠŸèƒ½ | Slack | MS Teams | Matrix | **DingTalk** |
|------|-------|----------|--------|--------------|
| æ–‡æœ¬æ¶ˆæ¯ | âœ… | âœ… | âœ… | âœ… |
| Markdown | âœ… | âœ… | âœ… | âœ… |
| äº’åŠ¨å¡ç‰‡ | âœ… | âœ… (Adaptive) | âŒ | âŒ |
| å›¾ç‰‡å‘é€ | âœ… | âœ… | âœ… | âŒ |
| æ–‡ä»¶å‘é€ | âœ… | âœ… | âœ… | âŒ |
| è¡¨æƒ…ååº” | âœ… | âŒ | âœ… | âŒ |
| çº¿ç¨‹æ”¯æŒ | âœ… | âœ… | âœ… | âŒ |
| å¼•ç”¨å›å¤ | âœ… | âœ… | âœ… | âŒ |
| æ¶ˆæ¯ç¼–è¾‘ | âœ… | âŒ | âœ… | âŒ |
| æŠ•ç¥¨ | âŒ | âœ… | âœ… | âŒ |
| ç¾¤ç®¡ç† | âœ… | âœ… | âœ… | âŒ |
| ç”¨æˆ·ç›®å½• | âœ… | âœ… | âœ… | âŒ |
| æµå¼ä¼ è¾“ | Token | Token | Token | Block |

---

## äº”ã€æ¨èå¼€å‘è·¯çº¿å›¾

### Phase 1: åŸºç¡€å¤šåª’ä½“ï¼ˆ2-3 å‘¨ï¼‰
1. âœ… å›¾ç‰‡å‘é€æ”¯æŒ
2. âœ… æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½
3. âœ… @æåŠæ£€æµ‹

### Phase 2: äº’åŠ¨å¡ç‰‡ï¼ˆ2-3 å‘¨ï¼‰
1. âœ… ActionCard åŸºç¡€æ”¯æŒ
2. âœ… æŒ‰é’®å›è°ƒå¤„ç†
3. âœ… å·¥å…·çŠ¶æ€å¡ç‰‡

### Phase 3: æ¶ˆæ¯å¢å¼ºï¼ˆ2 å‘¨ï¼‰
1. âœ… å¼•ç”¨å›å¤
2. âœ… å·²è¯»çŠ¶æ€
3. âœ… æ¶ˆæ¯æ’¤å›/ç¼–è¾‘

### Phase 4: ç›®å½•æœåŠ¡ï¼ˆ1-2 å‘¨ï¼‰
1. âœ… ç”¨æˆ·ä¿¡æ¯è·å–
2. âœ… ç¾¤æˆå‘˜åˆ—è¡¨
3. âœ… @æˆå‘˜åŠŸèƒ½

### Phase 5: é«˜çº§åŠŸèƒ½ï¼ˆæŒ‰éœ€ï¼‰
1. æŠ•ç¥¨åŠŸèƒ½
2. ç¾¤ç®¡ç†å·¥å…·
3. æ—¥ç¨‹/å®¡æ‰¹é›†æˆ

---

## å…­ã€æŠ€æœ¯å®ç°è¦ç‚¹

### 6.1 ActionCard å®ç°æ–¹æ¡ˆ

```typescript
// å‘é€ ActionCard
const actionCard = {
  msgtype: "actionCard",
  actionCard: {
    title: "é€‰æ‹©æ“ä½œ",
    text: "è¯·é€‰æ‹©æ‚¨è¦æ‰§è¡Œçš„æ“ä½œï¼š",
    btnOrientation: "1", // æŒ‰é’®ç«–å‘æ’åˆ—
    btns: [
      { title: "ç¡®è®¤", actionURL: "dingtalk://..." },
      { title: "å–æ¶ˆ", actionURL: "dingtalk://..." }
    ]
  }
};

// éœ€è¦å®ç°å›è°ƒå¤„ç†
api.registerHttpRoute({
  path: "/callback/actioncard",
  handler: handleActionCardCallback
});
```

### 6.2 åª’ä½“æ”¯æŒå®ç°æ–¹æ¡ˆ

```typescript
// ä¸Šä¼ å›¾ç‰‡è·å– mediaId
const uploadMedia = async (filePath: string) => {
  const formData = new FormData();
  formData.append("media", fs.createReadStream(filePath));
  formData.append("type", "image");

  const response = await axios.post(
    `${apiBase}/media/upload`,
    formData,
    { headers: { "x-acs-dingtalk-access-token": token } }
  );
  return response.data.media_id;
};

// å‘é€å›¾ç‰‡æ¶ˆæ¯
const sendImage = async (to: string, mediaId: string) => {
  await sendMessage({
    msgKey: "sampleImageMsg",
    msgParam: JSON.stringify({ mediaId })
  });
};
```

### 6.3 èƒ½åŠ›å£°æ˜æ›´æ–°

```typescript
const capabilities: ChannelCapabilities = {
  chatTypes: ["direct", "group"],
  reactions: false,        // æœªæ¥: true
  threads: false,          // DingTalk ä¸æ”¯æŒ
  media: true,             // éœ€å®ç°
  reply: true,             // éœ€å®ç°
  edit: false,             // éœ€è¯„ä¼°
  polls: false,            // éœ€å®ç°
  groupManagement: false,  // éœ€å®ç°
};
```

---

## ä¸ƒã€ç»“è®º

åŸºäºè°ƒç ”ç»“æœï¼Œ**DingTalk æ’ä»¶ç›®å‰åŠŸèƒ½ç›¸å¯¹åŸºç¡€**ï¼Œä¸ Slackã€MS Teams ç­‰æˆç†Ÿé€šé“ç›¸æ¯”å­˜åœ¨æ˜æ˜¾å·®è·ã€‚ä¼˜å…ˆå¼€å‘çš„åŠŸèƒ½åº”è¯¥æ˜¯ï¼š

1. **äº’åŠ¨å¡ç‰‡** - æå¤§æå‡äº¤äº’ä½“éªŒ
2. **å›¾ç‰‡/æ–‡ä»¶æ”¯æŒ** - å¤šåª’ä½“èƒ½åŠ›æ˜¯åˆšéœ€
3. **@æåŠæ£€æµ‹** - ç¾¤èŠåœºæ™¯å¿…å¤‡
4. **å¼•ç”¨å›å¤** - å¯¹è¯ä¸Šä¸‹æ–‡æ¸…æ™°åŒ–

è¿™äº›åŠŸèƒ½çš„å®ç°å°†ä½¿ DingTalk æ’ä»¶ä»"èƒ½ç”¨"æå‡åˆ°"å¥½ç”¨"çš„æ°´å¹³ã€‚
